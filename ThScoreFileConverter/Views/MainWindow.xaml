<Window x:Class="ThScoreFileConverter.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
        xmlns:mdb="clr-namespace:MvvmDialogBehavior;assembly=MvvmDialogBehavior"
        xmlns:a="clr-namespace:ThScoreFileConverter.Actions"
        xmlns:b="clr-namespace:ThScoreFileConverter.Behaviors"
        xmlns:prop="clr-namespace:ThScoreFileConverter.Properties"
        xmlns:vm="clr-namespace:ThScoreFileConverter.ViewModels"
        Closing="WndMain_Closing"
        Height="558"
        IsEnabled="{Binding IsIdle}"
        ResizeMode="CanMinimize"
        Style="{StaticResource WindowStyleKey}"
        Title="{Binding Title}"
        Width="505">

    <Window.DataContext>
        <vm:MainWindowViewModel/>
    </Window.DataContext>

    <i:Interaction.Behaviors>
        <mdb:DialogBehavior Content="{Binding AboutWindowViewModel}"
                            Owner="{Binding MainWindow, Source={x:Static Application.Current}}"
                            WindowStartupLocation="CenterOwner">
            <mdb:DialogBehavior.Style>
                <Style BasedOn="{StaticResource DialogStyleKey}"
                       TargetType="{x:Type Window}">
                    <Setter Property="SizeToContent"
                            Value="WidthAndHeight"/>
                    <Setter Property="Title"
                            Value="{Binding Content.Title, RelativeSource={x:Static RelativeSource.Self}}"/>
                </Style>
            </mdb:DialogBehavior.Style>
        </mdb:DialogBehavior>
        <mdb:DialogBehavior Content="{Binding SettingWindowViewModel}"
                            Owner="{Binding MainWindow, Source={x:Static Application.Current}}"
                            WindowStartupLocation="CenterOwner">
            <mdb:DialogBehavior.Style>
                <Style BasedOn="{StaticResource DialogStyleKey}"
                       TargetType="{x:Type Window}">
                    <Setter Property="Height"
                            Value="340"/>
                    <Setter Property="Title"
                            Value="{Binding Content.Title, RelativeSource={x:Static RelativeSource.Self}}"/>
                    <Setter Property="Width"
                            Value="420"/>
                </Style>
            </mdb:DialogBehavior.Style>
        </mdb:DialogBehavior>
    </i:Interaction.Behaviors>

    <Grid Margin="10,10,10,0"
          VerticalAlignment="Top">
        <Grid.RowDefinitions>
            <RowDefinition Height="45"/>
            <RowDefinition Height="180"/>
            <RowDefinition Height="95"/>
            <RowDefinition Height="45"/>
            <RowDefinition Height="90"/>
            <RowDefinition Height="45"/>
        </Grid.RowDefinitions>

        <ComboBox x:Name="cmbTitle"
                  DisplayMemberPath="Title"
                  Height="25"
                  HorizontalAlignment="Left"
                  ItemsSource="{Binding Works}"
                  Margin="10,10,0,10"
                  SelectedValue="{Binding LastWorkNumber, Mode=TwoWay}"
                  SelectedValuePath="Number"
                  Width="150">
            <ComboBox.ItemContainerStyle>
                <Style TargetType="{x:Type ComboBoxItem}">
                    <Style.Setters>
                        <Setter Property="IsEnabled"
                                Value="{Binding IsSupported}"/>
                    </Style.Setters>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding Title}"
                                     Value="">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="{x:Type ComboBoxItem}">
                                        <Separator/>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </ComboBox.ItemContainerStyle>
        </ComboBox>
        <Label x:Name="lblSupportedVersion"
               Content="{Binding SupportedVersions}"
               Margin="165,10,10,10"/>

        <Label Grid.Row="1"
               Content="スコア(_S):"
               Height="25"
               HorizontalAlignment="Left"
               Margin="10,10,0,0"
               Target="{Binding ElementName=txtScore, Mode=OneWay}"
               VerticalAlignment="Top"
               Width="120"/>
        <TextBox x:Name="txtScore"
                 Grid.Row="1"
                 Height="25"
                 HorizontalAlignment="Right"
                 IsReadOnly="True"
                 Margin="0,10,95,0"
                 Text="{Binding ScoreFile, UpdateSourceTrigger=PropertyChanged}"
                 VerticalAlignment="Top"
                 Width="245">
            <i:Interaction.Behaviors>
                <b:UIElementDropBehavior DropCommand="{Binding DropScoreFileCommand}"
                                         PreviewDragEnterCommand="{Binding DraggingCommand}"
                                         PreviewDragOverCommand="{Binding DraggingCommand}"/>
            </i:Interaction.Behaviors>
        </TextBox>
        <Button x:Name="btnScore"
                Grid.Row="1"
                Content="開く(_O)..."
                Height="25"
                HorizontalAlignment="Right"
                Margin="0,10,10,0"
                VerticalAlignment="Top"
                Width="75">
            <i:Interaction.Triggers>
                <i:EventTrigger EventName="Click">
                    <a:OpenFileDialogAction Filter="{x:Static prop:Resources.fltScoreFile}"
                                            InitialDirectory="{Binding OpenScoreFileDialogInitialDirectory}"
                                            OkCommand="{Binding SelectScoreFileCommand}"
                                            Owner="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Window}}}"/>
                </i:EventTrigger>
            </i:Interaction.Triggers>
        </Button>

        <Label x:Name="lblBestShot"
               Grid.Row="1"
               Content="ベストショット(_B):"
               Height="25"
               HorizontalAlignment="Left"
               IsEnabled="{Binding CanHandleBestShot}"
               Margin="10,40,0,0"
               Target="{Binding ElementName=txtBestShot, Mode=OneWay}"
               VerticalAlignment="Top"
               Width="120"/>
        <TextBox x:Name="txtBestShot"
                 Grid.Row="1"
                 Height="25"
                 HorizontalAlignment="Right"
                 IsEnabled="{Binding CanHandleBestShot}"
                 IsReadOnly="True"
                 Margin="0,40,95,0"
                 Text="{Binding BestShotDirectory, UpdateSourceTrigger=PropertyChanged}"
                 VerticalAlignment="Top"
                 Width="245">
            <i:Interaction.Behaviors>
                <b:UIElementDropBehavior DropCommand="{Binding DropBestShotDirectoryCommand}"
                                         PreviewDragEnterCommand="{Binding DraggingCommand}"
                                         PreviewDragOverCommand="{Binding DraggingCommand}"/>
            </i:Interaction.Behaviors>
        </TextBox>
        <Button x:Name="btnBestShot"
                Grid.Row="1"
                Click="BtnBestShot_Click"
                Command="{Binding SelectBestShotDirectoryCommand}"
                Content="開く(_O)..."
                Height="25"
                HorizontalAlignment="Right"
                IsEnabled="{Binding CanHandleBestShot}"
                Margin="0,40,10,0"
                VerticalAlignment="Top"
                Width="75"/>

        <Label Grid.Row="1"
               Content="テンプレート(_T):"
               Height="25"
               HorizontalAlignment="Left"
               Margin="10,70,0,0"
               Target="{Binding ElementName=lstTemplate, Mode=OneWay}"
               VerticalAlignment="Top"
               Width="120"/>
        <ListBox x:Name="lstTemplate"
                 Grid.Row="1"
                 ScrollViewer.HorizontalScrollBarVisibility="Visible"
                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                 AllowDrop="True"
                 Height="100"
                 HorizontalAlignment="Right"
                 ItemsSource="{Binding TemplateFiles, Mode=TwoWay}"
                 Margin="0,70,95,0"
                 SelectionMode="Multiple"
                 VerticalAlignment="Top"
                 Width="245">
            <i:Interaction.Behaviors>
                <b:UIElementDropBehavior DropCommand="{Binding DropTemplateFilesCommand}"
                                         PreviewDragEnterCommand="{Binding DraggingCommand}"
                                         PreviewDragOverCommand="{Binding DraggingCommand}"/>
            </i:Interaction.Behaviors>
            <i:Interaction.Triggers>
                <i:EventTrigger EventName="SelectionChanged">
                    <i:InvokeCommandAction Command="{Binding TemplateFilesSelectionChangedCommand}"/>
                </i:EventTrigger>
            </i:Interaction.Triggers>
        </ListBox>
        <Button x:Name="btnTemplateAdd"
                Grid.Row="1"
                Content="追加(_A)..."
                Height="25"
                HorizontalAlignment="Right"
                Margin="0,70,10,0"
                VerticalAlignment="Top"
                Width="75">
            <i:Interaction.Triggers>
                <i:EventTrigger EventName="Click">
                    <a:OpenFileDialogAction Filter="{x:Static prop:Resources.fltTemplateFile}"
                                            InitialDirectory="{Binding OpenTemplateFilesDialogInitialDirectory}"
                                            Multiselect="True"
                                            OkCommand="{Binding AddTemplateFilesCommand}"
                                            Owner="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Window}}}"/>
                </i:EventTrigger>
            </i:Interaction.Triggers>
        </Button>
        <Button x:Name="btnTemplateClear"
                Grid.Row="1"
                Command="{Binding DeleteTemplateFilesCommand}"
                CommandParameter="{Binding SelectedItems, ElementName=lstTemplate}"
                Content="削除(_C)"
                Height="25"
                HorizontalAlignment="Right"
                Margin="0,100,10,0"
                VerticalAlignment="Top"
                Width="75"/>
        <Button x:Name="btnTemplateClearAll"
                Grid.Row="1"
                Command="{Binding DeleteAllTemplateFilesCommand}"
                Content="全て削除(_L)"
                Height="25"
                HorizontalAlignment="Right"
                Margin="0,130,10,0"
                VerticalAlignment="Top"
                Width="75"/>

        <Label Grid.Row="2"
               Content="出力先(_O):"
               Height="25"
               HorizontalAlignment="Left"
               Margin="10,10,0,0"
               Target="{Binding ElementName=txtOutput, Mode=OneWay}"
               VerticalAlignment="Top"
               Width="120"/>
        <TextBox x:Name="txtOutput"
                 Grid.Row="2"
                 Height="25"
                 HorizontalAlignment="Right"
                 IsReadOnly="True"
                 Margin="0,10,95,0"
                 Text="{Binding OutputDirectory, UpdateSourceTrigger=PropertyChanged}"
                 VerticalAlignment="Top"
                 Width="245">
            <i:Interaction.Behaviors>
                <b:UIElementDropBehavior DropCommand="{Binding DropOutputDirectoryCommand}"
                                         PreviewDragEnterCommand="{Binding DraggingCommand}"
                                         PreviewDragOverCommand="{Binding DraggingCommand}"/>
            </i:Interaction.Behaviors>
        </TextBox>
        <Button x:Name="btnOutput"
                Grid.Row="2"
                Click="BtnOutput_Click"
                Command="{Binding SelectOutputDirectoryCommand}"
                Content="開く(_O)..."
                Height="25"
                HorizontalAlignment="Right"
                Margin="0,10,10,0"
                VerticalAlignment="Top"
                Width="75"/>

        <Label x:Name="lblImageOutput"
               Grid.Row="2"
               Content="画像出力先(_I):"
               Height="25"
               HorizontalAlignment="Left"
               IsEnabled="{Binding CanHandleBestShot}"
               Margin="10,40,0,0"
               Target="{Binding ElementName=txtImageOutput, Mode=OneWay}"
               VerticalAlignment="Top"
               Width="120"/>
        <TextBox x:Name="txtImageOutput"
                 Grid.Row="2"
                 Height="25"
                 HorizontalAlignment="Right"
                 IsEnabled="{Binding CanHandleBestShot}"
                 Margin="0,40,95,0"
                 Text="{Binding ImageOutputDirectory, UpdateSourceTrigger=PropertyChanged}"
                 VerticalAlignment="Top"
                 Width="245"/>
        <CheckBox x:Name="chkHideUntriedCards"
                  Grid.Row="2"
                  Content="未挑戦のスペルカード名を出力しない(_H)"
                  HorizontalAlignment="Right"
                  IsEnabled="{Binding CanReplaceCardNames}"
                  IsChecked="{Binding HidesUntriedCards}"
                  Margin="0,70,10,0"
                  VerticalAlignment="Top"
                  Width="330"/>

        <Button x:Name="btnConvert"
                Grid.Row="3"
                Command="{Binding ConvertCommand}"
                Content="変換(_V)"
                Height="25"
                HorizontalAlignment="Center"
                IsDefault="True"
                Margin="0,10"
                Width="100"/>

        <TextBox x:Name="txtLog"
                 Grid.Row="4"
                 AllowDrop="False"
                 FontSize="10"
                 IsReadOnly="True"
                 IsUndoEnabled="False"
                 Margin="10"
                 Text="{Binding Log, NotifyOnTargetUpdated=True}"
                 TextWrapping="Wrap"
                 VerticalScrollBarVisibility="Visible">
            <i:Interaction.Behaviors>
                <b:TextBoxBaseScrollBehavior AutoScrollToEnd="True"/>
            </i:Interaction.Behaviors>
        </TextBox>

        <Button x:Name="btnSetting"
                Grid.Row="5"
                Command="{Binding OpenSettingWindowCommand}"
                Content="設定(_S)..."
                Height="25"
                HorizontalAlignment="Right"
                Margin="0,10,75,10"
                Width="75"/>
        <Button x:Name="btnAbout"
                Grid.Row="5"
                Command="{Binding OpenAboutWindowCommand}"
                Content="_About..."
                Height="25"
                HorizontalAlignment="Right"
                Margin="0,10,10,10"
                Width="60"/>
    </Grid>
</Window>
